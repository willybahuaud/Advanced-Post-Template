(()=>{"use strict";const t=window.React,e=window.wp.i18n,n=window.wp.hooks,a=window.wp.compose,o=window.wp.blockEditor,r=window.wp.element,l=window.wp.data,c=window.wp.components,i=c.NumberControl||c.__experimentalNumberControl,s={aptStartFrom:{type:"number",default:1},aptShowCount:{type:"number",default:0},aptSkipLast:{type:"number",default:0}};(0,n.addFilter)("blocks.registerBlockType","wabeo/apt-extend-attrs",(t,e)=>"core/post-template"!==e?t:{...t,attributes:{...t.attributes,...s}});const m=(0,a.createHigherOrderComponent)(n=>a=>{if("core/post-template"!==a.name)return(0,t.createElement)(n,{...a});const{attributes:s,setAttributes:m}=a,{aptStartFrom:p,aptShowCount:u,aptSkipLast:d}=s;return(0,r.useEffect)(()=>{const{clientId:t}=a;if(!t)return;const e=()=>{let e=document.querySelector(`[data-block="${t}"]`);if(e)return e;const n=Array.from(document.querySelectorAll('iframe[name="editor-canvas"], .editor-canvas iframe, iframe.components-iframe__frame'));for(const a of n)try{const n=a.contentDocument||a.contentWindow?.document;if(!n)continue;if(e=n.querySelector(`[data-block="${t}"]`),e)return e}catch(t){}return null},n=t=>t?t.matches&&t.matches("ul.wp-block-post-template, ol.wp-block-post-template")?t:t.querySelector("ul.wp-block-post-template, ol.wp-block-post-template"):null,o=()=>{const a=(0,l.select)("core/block-editor").getBlock(t);if(!a)return;const{aptStartFrom:o=1,aptShowCount:r=0,aptSkipLast:c=0}=a.attributes||{},i=e();if(!i)return;const s=(i.ownerDocument||document).getElementById(`apt-style-${t}`);s&&s.remove();const m=n(i);if(!m)return;const p=(t=>{if(!t)return[];const e=Array.from(t.children).filter(t=>"LI"===t.tagName);return e.forEach(t=>{t.dataset&&"1"===t.dataset.aptHidden&&(t.style.display="",delete t.dataset.aptHidden)}),e.filter(t=>{const e=(t.ownerDocument||document).defaultView.getComputedStyle(t);return e&&"none"!==e.display})})(m),u=p.length;if(0===u)return;const d=Math.max(0,parseInt(o||1,10)-1),w=Math.max(0,parseInt(r||0,10)),f=Math.max(0,parseInt(c||0,10)),b=Math.max(0,u-f),h=w>0?Math.min(d+w,b):b;p.forEach((t,e)=>{(e<d||e>=h)&&(t.style.display="none",t.dataset&&(t.dataset.aptHidden="1"))})};let r=0;const c=()=>{r&&cancelAnimationFrame(r),r=requestAnimationFrame(o)},i=(0,l.subscribe)(c),s=new MutationObserver(()=>c());let m=!1,p=0;const u=()=>{const t=e();if(!t)return!1;const a=n(t)||t;try{return s.observe(a,{childList:!0,subtree:!0}),m=!0,!0}catch(t){return!1}};if(!u()){let t=0;const e=()=>{t+=1,m||t>20||(u()?c():p=window.setTimeout(e,250))};p=window.setTimeout(e,250)}return c(),()=>{i&&i(),r&&cancelAnimationFrame(r),s.disconnect(),p&&window.clearTimeout(p)}},[a.clientId]),(0,t.createElement)(t.Fragment,null,(0,t.createElement)(n,{...a}),(0,t.createElement)(o.InspectorControls,null,(0,t.createElement)(c.PanelBody,{title:(0,e.__)("Tronquer l’affichage","advanced-post-template"),initialOpen:!0},(0,t.createElement)(i,{label:(0,e.__)("Tronquer au début","advanced-post-template"),min:0,value:p,onChange:t=>m({aptStartFrom:parseInt(t||0,10)||0})}),(0,t.createElement)(i,{label:(0,e.__)("Maximum à afficher (0 = tous)","advanced-post-template"),min:0,value:u,onChange:t=>m({aptShowCount:Math.max(0,parseInt(t||0,10)||0)})}),(0,t.createElement)(i,{label:(0,e.__)("Tronquer à la fin","advanced-post-template"),min:0,value:d,onChange:t=>m({aptSkipLast:Math.max(0,parseInt(t||0,10)||0)})}))))},"withAPTControls");(0,n.addFilter)("editor.BlockEdit","wabeo/apt-controls",m)})();