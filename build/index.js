(()=>{"use strict";const t=window.React,e=window.wp.i18n,a=window.wp.hooks,r=window.wp.compose,o=window.wp.blockEditor,n=window.wp.element,l=window.wp.data,s=window.wp.components,c=s.NumberControl||s.__experimentalNumberControl,p={aptStartFrom:{type:"number",default:1},aptShowCount:{type:"number",default:0},aptSkipLast:{type:"number",default:0}};(0,a.addFilter)("blocks.registerBlockType","wabeo/apt-extend-attrs",(t,e)=>"core/post-template"!==e?t:{...t,attributes:{...t.attributes,...p}});const i=(0,r.createHigherOrderComponent)(a=>r=>{if("core/post-template"!==r.name)return(0,t.createElement)(a,{...r});const{attributes:p,setAttributes:i}=r,{aptStartFrom:m,aptShowCount:u,aptSkipLast:d}=p;return(0,n.useEffect)(()=>{const{clientId:t}=r;if(!t)return;const e=()=>{const e=(0,l.select)("core/block-editor").getBlock(t);if(!e)return;const{aptStartFrom:a=1,aptShowCount:r=0,aptSkipLast:o=0}=e.attributes||{},n=document.querySelector(`[data-block="${t}"]`);if(!n)return;const s=n.querySelector(".wp-block-post-template")||n;let c=Array.from(s.querySelectorAll(".wp-block-post"));0===c.length&&(c=Array.from(s.querySelectorAll("li")));const p=c.length;if(c.forEach(t=>t.style.removeProperty("display")),0===p)return;const i=Math.max(0,parseInt(a||1,10)-1),m=Math.max(0,parseInt(r||0,10)),u=Math.max(0,parseInt(o||0,10)),d=Math.max(0,p-u),w=m>0?Math.min(i+m,d):d;i>=w?c.forEach(t=>t.style.display="none"):c.forEach((t,e)=>{(e<i||e>=w)&&(t.style.display="none")})};let a=0;const o=()=>{a&&cancelAnimationFrame(a),a=requestAnimationFrame(e)},n=(0,l.subscribe)(o),s=new MutationObserver(()=>o());return(()=>{const e=document.querySelector(`[data-block="${t}"]`);e&&s.observe(e,{childList:!0,subtree:!0})})(),o(),()=>{n&&n(),a&&cancelAnimationFrame(a),s.disconnect()}},[r.clientId]),(0,t.createElement)(t.Fragment,null,(0,t.createElement)(a,{...r}),(0,t.createElement)(o.InspectorControls,null,(0,t.createElement)(s.PanelBody,{title:(0,e.__)("Affichage – Tranche","advanced-post-template"),initialOpen:!0},(0,t.createElement)(c,{label:(0,e.__)("Démarrer à partir du Xème post (1 = premier)","advanced-post-template"),min:1,value:m,onChange:t=>i({aptStartFrom:parseInt(t||1,10)||1})}),(0,t.createElement)(c,{label:(0,e.__)("Afficher X posts (0 = tous possibles)","advanced-post-template"),min:0,value:u,onChange:t=>i({aptShowCount:Math.max(0,parseInt(t||0,10)||0)})}),(0,t.createElement)(c,{label:(0,e.__)("Ignorer X posts à la fin","advanced-post-template"),min:0,value:d,onChange:t=>i({aptSkipLast:Math.max(0,parseInt(t||0,10)||0)})}))))},"withAPTControls");(0,a.addFilter)("editor.BlockEdit","wabeo/apt-controls",i)})();