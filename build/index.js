(()=>{"use strict";const e=window.React,t=window.wp.i18n,o=window.wp.hooks,r=window.wp.compose,n=window.wp.blockEditor,a=window.wp.element,l=window.wp.data,c=window.wp.components,s=c.NumberControl||c.__experimentalNumberControl,i={aptStartFrom:{type:"number",default:1},aptShowCount:{type:"number",default:0},aptSkipLast:{type:"number",default:0}};(0,o.addFilter)("blocks.registerBlockType","wabeo/apt-extend-attrs",(e,t)=>"core/post-template"!==t?e:{...e,attributes:{...e.attributes,...i}});const p=(0,r.createHigherOrderComponent)(o=>r=>{if("core/post-template"!==r.name)return(0,e.createElement)(o,{...r});const{attributes:i,setAttributes:p}=r,{aptStartFrom:m,aptShowCount:u,aptSkipLast:d}=i;return(0,a.useEffect)(()=>{const{clientId:e}=r;if(!e)return;const t=(...e)=>{window.APT_DEBUG&&console.debug("[APT]",...e)},o=()=>{let t=document.querySelector(`[data-block="${e}"]`);if(t)return t;const o=Array.from(document.querySelectorAll('iframe[name="editor-canvas"], .editor-canvas iframe, iframe.components-iframe__frame'));for(const r of o)try{const o=r.contentDocument||r.contentWindow?.document;if(!o)continue;if(t=o.querySelector(`[data-block="${e}"]`),t)return t}catch(e){}return null},n=()=>{const r=(0,l.select)("core/block-editor").getBlock(e);if(!r)return;const{aptStartFrom:n=1,aptShowCount:a=0,aptSkipLast:c=0}=r.attributes||{},s=o();if(!s)return void t("root not found for",e);const i=s.querySelector("ul.wp-block-post-template, ol.wp-block-post-template");let p=[];if(i)p=Array.from(i.querySelectorAll(":scope > li"));else{const e=s.querySelector(".wp-block-post-template")||s;p=Array.from(e.querySelectorAll(".wp-block-post")),0===p.length&&(p=Array.from(e.querySelectorAll("li")))}const m=p.length;if(t("items total",m,{s:n,c:a,k:c}),p.forEach(e=>e.style.removeProperty("display")),0===m)return;const u=Math.max(0,parseInt(n||1,10)-1),d=Math.max(0,parseInt(a||0,10)),f=Math.max(0,parseInt(c||0,10)),w=Math.max(0,m-f),b=d>0?Math.min(u+d,w):w;t("calc",{startIndex:u,endIndex:b,endCap:w,total:m}),u>=b?p.forEach(e=>e.style.display="none"):p.forEach((e,t)=>{(t<u||t>=b)&&(e.style.display="none")})};let a=0;const c=()=>{a&&cancelAnimationFrame(a),a=requestAnimationFrame(n)},s=(0,l.subscribe)(c),i=new MutationObserver(()=>c());return(()=>{const r=o();if(r)try{i.observe(r,{childList:!0,subtree:!0}),t("observer mounted on",e)}catch(e){t("observer error",e)}else t("block el not found on mount")})(),t("effect mounted",e),c(),()=>{s&&s(),a&&cancelAnimationFrame(a),i.disconnect()}},[r.clientId]),(0,e.createElement)(e.Fragment,null,(0,e.createElement)(o,{...r}),(0,e.createElement)(n.InspectorControls,null,(0,e.createElement)(c.PanelBody,{title:(0,t.__)("Affichage – Tranche","advanced-post-template"),initialOpen:!0},(0,e.createElement)(s,{label:(0,t.__)("Démarrer à partir du Xème post (1 = premier)","advanced-post-template"),min:1,value:m,onChange:e=>p({aptStartFrom:parseInt(e||1,10)||1})}),(0,e.createElement)(s,{label:(0,t.__)("Afficher X posts (0 = tous possibles)","advanced-post-template"),min:0,value:u,onChange:e=>p({aptShowCount:Math.max(0,parseInt(e||0,10)||0)})}),(0,e.createElement)(s,{label:(0,t.__)("Ignorer X posts à la fin","advanced-post-template"),min:0,value:d,onChange:e=>p({aptSkipLast:Math.max(0,parseInt(e||0,10)||0)})}))))},"withAPTControls");(0,o.addFilter)("editor.BlockEdit","wabeo/apt-controls",p)})();