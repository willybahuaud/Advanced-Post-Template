(()=>{"use strict";const t=window.React,e=window.wp.i18n,a=window.wp.hooks,o=window.wp.compose,n=window.wp.blockEditor,r=window.wp.element,l=window.wp.data,s=window.wp.components,c=s.NumberControl||s.__experimentalNumberControl,i={aptStartFrom:{type:"number",default:1},aptShowCount:{type:"number",default:0},aptSkipLast:{type:"number",default:0}};(0,a.addFilter)("blocks.registerBlockType","wabeo/apt-extend-attrs",(t,e)=>"core/post-template"!==e?t:{...t,attributes:{...t.attributes,...i}});const p=(0,o.createHigherOrderComponent)(a=>o=>{if("core/post-template"!==o.name)return(0,t.createElement)(a,{...o});const{attributes:i,setAttributes:p}=o,{aptStartFrom:d,aptShowCount:m,aptSkipLast:u}=i;return(0,r.useEffect)(()=>{const{clientId:t}=o;if(!t)return;const e=(...t)=>{window.APT_DEBUG&&console.debug("[APT]",...t)},a=()=>{let e=document.querySelector(`[data-block="${t}"]`);if(e)return e;const a=Array.from(document.querySelectorAll('iframe[name="editor-canvas"], .editor-canvas iframe, iframe.components-iframe__frame'));for(const o of a)try{const a=o.contentDocument||o.contentWindow?.document;if(!a)continue;if(e=a.querySelector(`[data-block="${t}"]`),e)return e}catch(t){}return null},n=()=>{const o=(0,l.select)("core/block-editor").getBlock(t);if(!o)return;const{aptStartFrom:n=1,aptShowCount:r=0,aptSkipLast:s=0}=o.attributes||{},c=a();if(!c)return void e("root not found for",t);const i=c.querySelector("ul.wp-block-post-template, ol.wp-block-post-template");let p=[];if(i)p=Array.from(i.querySelectorAll(":scope > li"));else{const t=c.querySelector(".wp-block-post-template")||c;p=Array.from(t.querySelectorAll(".wp-block-post")),0===p.length&&(p=Array.from(t.querySelectorAll("li")))}const d=p.length;if(e("items total",d,{s:n,c:r,k:s}),p.forEach(t=>{t.dataset&&"1"===t.dataset.aptHidden&&(t.style.display="",delete t.dataset.aptHidden)}),0===d)return;const m=Math.max(0,parseInt(n||1,10)-1),u=Math.max(0,parseInt(r||0,10)),f=Math.max(0,parseInt(s||0,10)),w=Math.max(0,d-f),b=u>0?Math.min(m+u,w):w;e("calc",{startIndex:m,endIndex:b,endCap:w,total:d}),m>=b?p.forEach(t=>{t.style.display="none",t.dataset&&(t.dataset.aptHidden="1")}):p.forEach((t,e)=>{(e<m||e>=b)&&(t.style.display="none",t.dataset&&(t.dataset.aptHidden="1"))})};let r=0;const s=()=>{r&&cancelAnimationFrame(r),r=requestAnimationFrame(n)},c=(0,l.subscribe)(s),i=new MutationObserver(()=>s());return(()=>{const o=a();if(o)try{i.observe(o,{childList:!0,subtree:!0}),e("observer mounted on",t)}catch(t){e("observer error",t)}else e("block el not found on mount")})(),e("effect mounted",t),s(),()=>{c&&c(),r&&cancelAnimationFrame(r),i.disconnect()}},[o.clientId]),(0,t.createElement)(t.Fragment,null,(0,t.createElement)(a,{...o}),(0,t.createElement)(n.InspectorControls,null,(0,t.createElement)(s.PanelBody,{title:(0,e.__)("Affichage – Tranche","advanced-post-template"),initialOpen:!0},(0,t.createElement)(c,{label:(0,e.__)("Démarrer à partir du Xème post (1 = premier)","advanced-post-template"),min:1,value:d,onChange:t=>p({aptStartFrom:parseInt(t||1,10)||1})}),(0,t.createElement)(c,{label:(0,e.__)("Afficher X posts (0 = tous possibles)","advanced-post-template"),min:0,value:m,onChange:t=>p({aptShowCount:Math.max(0,parseInt(t||0,10)||0)})}),(0,t.createElement)(c,{label:(0,e.__)("Ignorer X posts à la fin","advanced-post-template"),min:0,value:u,onChange:t=>p({aptSkipLast:Math.max(0,parseInt(t||0,10)||0)})}))))},"withAPTControls");(0,a.addFilter)("editor.BlockEdit","wabeo/apt-controls",p)})();