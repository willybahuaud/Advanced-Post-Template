(()=>{"use strict";const t=window.React,e=window.wp.i18n,a=window.wp.hooks,n=window.wp.compose,o=window.wp.blockEditor,r=window.wp.element,c=window.wp.data,l=window.wp.components,s=l.NumberControl||l.__experimentalNumberControl,i={aptStartFrom:{type:"number",default:1},aptShowCount:{type:"number",default:0},aptSkipLast:{type:"number",default:0}};(0,a.addFilter)("blocks.registerBlockType","wabeo/apt-extend-attrs",(t,e)=>"core/post-template"!==e?t:{...t,attributes:{...t.attributes,...i}});const p=(0,n.createHigherOrderComponent)(a=>n=>{if("core/post-template"!==n.name)return(0,t.createElement)(a,{...n});const{attributes:i,setAttributes:p}=n,{aptStartFrom:m,aptShowCount:d,aptSkipLast:u}=i;return(0,r.useEffect)(()=>{const{clientId:t}=n;if(!t)return;const e=()=>{let e=document.querySelector(`[data-block="${t}"]`);if(e)return e;const a=Array.from(document.querySelectorAll('iframe[name="editor-canvas"], .editor-canvas iframe, iframe.components-iframe__frame'));for(const n of a)try{const a=n.contentDocument||n.contentWindow?.document;if(!a)continue;if(e=a.querySelector(`[data-block="${t}"]`),e)return e}catch(t){}return null},a=()=>{const a=(0,c.select)("core/block-editor").getBlock(t);if(!a)return;const{aptStartFrom:n=1,aptShowCount:o=0,aptSkipLast:r=0}=a.attributes||{},l=e();if(!l)return;const s=(l.ownerDocument||document).getElementById(`apt-style-${t}`);s&&s.remove();const i=l.matches&&l.matches("ul.wp-block-post-template, ol.wp-block-post-template")?l:l.querySelector("ul.wp-block-post-template, ol.wp-block-post-template");if(!i)return;const p=Array.from(i.children).filter(t=>"LI"===t.tagName);p.forEach(t=>{t.dataset&&"1"===t.dataset.aptHidden&&(t.style.display="",delete t.dataset.aptHidden)});const m=p.filter(t=>{const e=(t.ownerDocument||document).defaultView.getComputedStyle(t);return e&&"none"!==e.display}),d=m.length;if(0===d)return;const u=Math.max(0,parseInt(n||1,10)-1),w=Math.max(0,parseInt(o||0,10)),f=Math.max(0,parseInt(r||0,10)),b=Math.max(0,d-f),h=w>0?Math.min(u+w,b):b;m.forEach((t,e)=>{(e<u||e>=h)&&(t.style.display="none",t.dataset&&(t.dataset.aptHidden="1"))})};let o=0;const r=()=>{o&&cancelAnimationFrame(o),o=requestAnimationFrame(a)},l=(0,c.subscribe)(r),s=new MutationObserver(()=>r());return(()=>{const t=e();if(t)try{s.observe(t,{childList:!0,subtree:!0})}catch(t){}})(),r(),()=>{l&&l(),o&&cancelAnimationFrame(o),s.disconnect()}},[n.clientId]),(0,t.createElement)(t.Fragment,null,(0,t.createElement)(a,{...n}),(0,t.createElement)(o.InspectorControls,null,(0,t.createElement)(l.PanelBody,{title:(0,e.__)("Affichage – Tranche","advanced-post-template"),initialOpen:!0},(0,t.createElement)(s,{label:(0,e.__)("Démarrer à partir du Xème post (1 = premier)","advanced-post-template"),min:1,value:m,onChange:t=>p({aptStartFrom:parseInt(t||1,10)||1})}),(0,t.createElement)(s,{label:(0,e.__)("Afficher X posts (0 = tous possibles)","advanced-post-template"),min:0,value:d,onChange:t=>p({aptShowCount:Math.max(0,parseInt(t||0,10)||0)})}),(0,t.createElement)(s,{label:(0,e.__)("Ignorer X posts à la fin","advanced-post-template"),min:0,value:u,onChange:t=>p({aptSkipLast:Math.max(0,parseInt(t||0,10)||0)})}))))},"withAPTControls");(0,a.addFilter)("editor.BlockEdit","wabeo/apt-controls",p)})();